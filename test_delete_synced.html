<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Delete Synced Restaurant</title>
    <script src="https://unpkg.com/dexie@3.2.2/dist/dexie.js"></script>
</head>
<body>
    <h1>Test Delete Synced Restaurant</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        async function testDeleteScenarios() {
            try {
                // Open the database
                const db = new Dexie('RestaurantCurator');
                db.version(1).stores({
                    restaurants: '++id, name, curatorId, timestamp, transcription, description, origin, source, serverId, deletedLocally, deletedAt, sharedRestaurantId, originalCuratorId'
                });
                
                output.innerHTML += '<h2>Fetching all restaurants...</h2>';
                
                const allRestaurants = await db.restaurants.toArray();
                output.innerHTML += `<p>Total restaurants in DB: ${allRestaurants.length}</p>`;
                
                // Find synced restaurants
                const syncedRestaurants = allRestaurants.filter(r => r.serverId != null);
                output.innerHTML += `<p>Synced restaurants: ${syncedRestaurants.length}</p>`;
                
                // Find local restaurants
                const localRestaurants = allRestaurants.filter(r => !r.serverId || r.source === 'local');
                output.innerHTML += `<p>Local restaurants: ${localRestaurants.length}</p>`;
                
                // Display details of synced restaurants
                output.innerHTML += '<h3>Synced Restaurants Details:</h3>';
                for (const r of syncedRestaurants.slice(0, 5)) {
                    output.innerHTML += `
                        <div style="border: 1px solid #ccc; padding: 10px; margin: 10px 0;">
                            <p><strong>ID:</strong> ${r.id}</p>
                            <p><strong>Name:</strong> ${r.name}</p>
                            <p><strong>ServerId:</strong> ${r.serverId}</p>
                            <p><strong>Source:</strong> ${r.source}</p>
                            <p><strong>DeletedLocally:</strong> ${r.deletedLocally}</p>
                            <p><strong>Can Delete:</strong> ${canDelete(r) ? 'YES' : 'NO'}</p>
                        </div>
                    `;
                }
                
                function canDelete(restaurant) {
                    const isLocal = !restaurant.serverId || 
                                   !restaurant.source || 
                                   restaurant.source === 'local';
                    return true; // Should always be able to delete
                }
                
            } catch (error) {
                output.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
                console.error(error);
            }
        }
        
        testDeleteScenarios();
    </script>
</body>
</html>
